# SeraApp - تطبيق SERA للنماذج الرقمية

تطبيق iOS مبني بـ SwiftUI لملء النماذج الرقمية وإنشاء ملفات PDF، مع دعم للغة العربية ووضع عدم الاتصال (Offline) وتحسينات حديثة لسهولة الاستخدام.

## ✨ المميزات الجديدة

### 🔧 **تحديثات المدخلات لسهولة الاستخدام**

#### 📅 **التاريخ والوقت**

- **اليوم**: خيارات محددة من أيام الأسبوع (السبت - الجمعة)
- **الساعة**: اختيار من 24 ساعة (00:00 - 23:00)
- **التاريخ الهجري**: محصور في شهر ذو الحجة 1446 هـ فقط (1-30)

#### 🔢 **الحقول الرقمية**

- **سعة العداد**: إدخال رقمي بوحدة الكيلووات (kW)
- **الحمل الحالي**: إدخال رقمي بوحدة الكيلووات (kW)
- **الحمل الأقصى المسجل**: إدخال رقمي بوحدة الكيلووات (kW)
- **مدة الانقطاع**: إدخال رقمي بوحدة الساعة
- **عدد المتأثرين**: إدخال رقمي صحيح (مشترك)

#### 📆 **التاريخ المستهدف للتوصيات**

- اختيار هجري من السنة الحالية (1446) وما بعدها حتى 1450
- اختيار من جميع الأشهر الهجرية
- اختيار اليوم (1-30)

## 🏗️ **بنية التطبيق**

### الخدمات المتاحة

#### 1. **الخدمة الرئيسية: ملء النموذج الكامل**

نموذج مفصل لتقرير انقطاع الخدمة الكهربائية يشمل:

### القسم الأول: معلومات أساسية

- **اليوم**: اختيار من أيام الأسبوع
- **الساعة**: اختيار من ساعات اليوم (24 ساعة)
- **التاريخ**: ذو الحجة 1446 هـ (1-30)
- **الموقع**: نص حر

### القسم الثاني: بيانات الموقع/المواقع المتأثرة

- **رقم الاشتراك/الاشتراكات**: نص حر
- **سعة العداد**: رقمي (kW)
- **الحمل الحالي**: رقمي (kW)
- **الحمل الأقصى المسجل**: رقمي (kW)
- **طريقة التغذية**: نص حر

### القسم الثالث: مصدر البلاغ

خيارات متعددة (checkboxes):

- بلاغ وارد لمركز منظومة الطاقة
- بلاغ من المرخص له
- رصد في مركز التحكم الخاص بالمرخص له
- انقطاع خلال زيارة ميدانية
- بلاغ من شركة كدانة
- بلاغ من الشركة المشغلة لمخيمات
- أخرى

### القسم الرابع: التحقق وتفاصيل الانقطاع والإعادة

- **تفاصيل التحقق**: نص متعدد الأسطر

### القسم الخامس: مراحل إعادة الخدمة الكهربائية (حتى 3 مراحل)

لكل مرحلة:

- **رقم المرحلة**: نص حر
- **مدة الانقطاع**: رقمي (ساعة)
- **مصدر الإعادة**: نص حر
- **عدد المتأثرين**: رقمي صحيح (مشترك)
- **طريقة الإعادة**: نص حر

### القسم السادس: تفاصيل إضافية

- **التحقق الإضافي**: نص متعدد الأسطر

### القسم السابع: التوصيات (حتى 3 توصيات)

لكل توصية:

- **نص التوصية**: نص متعدد الأسطر
- **الجهة المسؤولة**: نص حر
- **مصدر الإعادة**: نص حر
- **التاريخ المستهدف**: اختيار هجري (1446-1450)

### القسم الثامن: التواقيع (حتى 5 توقيع)

لكل توقيع:

- **الجهة**: نص حر
- **ممثل الجهة**: نص حر
- **الصفة**: نص حر

### القسم التاسع: الصور المرفقة

- **رفع الصور**: حتى 8 صور من الكاميرا أو معرض الصور
- **ترتيب ثابت**: 4 صور في كل من آخر صفحتين

#### 2. **الخدمة المساعدة: إضافة الصور فقط**

خدمة مبسطة لإضافة الصور لملف PDF موجود:

- اختيار ملف PDF من الجهاز
- رفع حتى 8 صور
- إضافة الصور في آخر صفحتين (4 صور لكل صفحة)

## 🧰 **المكونات الجديدة**

### NumericFieldView

مكون لإدخال الأرقام العشرية مع وحدة القياس:

```swift
NumericFieldView(
    title: "سعة العداد (كيلووات)",
    value: $formData.meterCapacityValue,
    placeholder: "أدخل سعة العداد",
    unit: "kW"
)
```

### IntegerFieldView

مكون لإدخال الأرقام الصحيحة مع وحدة القياس:

```swift
IntegerFieldView(
    title: "عدد المتأثرين",
    value: $phase.affectedCountValue,
    placeholder: "أدخل عدد المتأثرين",
    unit: "مشترك"
)
```

### HijriDatePickerView

مكون لاختيار التاريخ الهجري:

```swift
HijriDatePickerView(
    title: "التاريخ المستهدف",
    year: $recommendation.targetHijriYear,
    month: $recommendation.targetHijriMonth,
    day: $recommendation.targetHijriDay
)
```

## 🔄 **التوافق العكسي**

تم الحفاظ على التوافق العكسي من خلال computed properties في FormFieldsModel:

```swift
// للتوافق مع النظام القديم
var day: String { selectedDay }
var time: String { selectedHour }
var date: String { "ذو الحجة \(selectedHijriDay), 1446 هـ" }
var meterCapacity: String {
    meterCapacityValue == 0 ? "" : String(format: "%.1f", meterCapacityValue)
}
```

## 📊 **مطابقة الحقول (Field Mapping)**

يستخدم التطبيق مطابقة دقيقة لحقول PDF:

### البيانات الأساسية

- `doc_0_doc_0_Text_1` ← اليوم المختار
- `doc_0_doc_0_Text_2` ← الساعة المختارة
- `doc_0_doc_0_Text_3` ← الموقع
- `doc_0_doc_0_Text_6` ← التاريخ الهجري
- `doc_0_doc_0_Text_7` ← سعة العداد
- `doc_0_doc_0_Text_8` ← الحمل الحالي
- `doc_0_doc_0_Text_9` ← الحمل الأقصى المسجل

### مراحل الإعادة (3 مراحل)

#### المرحلة الأولى

- `doc_0_doc_0_Text_12` ← رقم المرحلة
- `doc_0_doc_0_Text_15` ← مدة الانقطاع
- `doc_0_doc_0_Text_26` ← مصدر الإعادة
- `doc_0_doc_0_Text_24` ← عدد المتأثرين
- `doc_0_doc_0_Text_22` ← طريقة الإعادة

#### المرحلة الثانية

- `doc_0_doc_0_Text_13` ← رقم المرحلة
- `doc_0_doc_0_Text_16` ← مدة الانقطاع
- `doc_0_doc_0_Text_25` ← مصدر الإعادة
- `doc_0_doc_0_Text_23` ← عدد المتأثرين
- `doc_0_doc_0_Text_21` ← طريقة الإعادة

#### المرحلة الثالثة

- `doc_0_doc_0_Text_14` ← رقم المرحلة
- `doc_0_doc_0_Text_17` ← مدة الانقطاع
- `doc_0_doc_0_Text_18` ← مصدر الإعادة
- `doc_0_doc_0_Text_19` ← عدد المتأثرين
- `doc_0_doc_0_Text_20` ← طريقة الإعادة

### التوصيات (3 توصيات)

#### التوصية الأولى

- `doc_0_doc_0_Text_27` ← نص التوصية
- `doc_0_doc_0_Text_38` ← الجهة المسؤولة
- `doc_0_doc_0_Text_36` ← مصدر الإعادة
- `doc_0_doc_0_Text_34` ← التاريخ المستهدف

#### التوصية الثانية

- `doc_0_doc_0_Text_28` ← نص التوصية
- `doc_0_doc_0_Text_37` ← الجهة المسؤولة
- `doc_0_doc_0_Text_35` ← مصدر الإعادة
- `doc_0_doc_0_Text_33` ← التاريخ المستهدف

#### التوصية الثالثة

- `doc_0_doc_0_Text_29` ← نص التوصية
- `doc_0_doc_0_Text_30` ← الجهة المسؤولة
- `doc_0_doc_0_Text_31` ← مصدر الإعادة
- `doc_0_doc_0_Text_32` ← التاريخ المستهدف

### التواقيع (5 توقيع)

#### التوقيع 1-5

- `doc_0_doc_0_Text_44,43,42,47,48` ← الجهة
- `doc_0_doc_0_Text_58,39,40,51,52` ← ممثل الجهة
- `doc_0_doc_0_Text_46,45,41,49,50` ← الصفة

## 🎯 **هيكل البيانات المحدث**

#### FormFieldsModel

```swift
class FormFieldsModel: ObservableObject {
    // الخيارات المحددة
    @Published var selectedDay: String = ""
    @Published var selectedHour: String = ""
    @Published var selectedHijriDay: Int = 1

    // الحقول الرقمية
    @Published var meterCapacityValue: Double = 0.0
    @Published var currentLoadValue: Double = 0.0
    @Published var maxRecordedLoadValue: Double = 0.0

    // خيارات أيام الأسبوع
    let daysOfWeek = ["السبت", "الأحد", "الاثنين", "الثلاثاء", "الأربعاء", "الخميس", "الجمعة"]

    // خيارات الساعات (24 ساعة)
    let hoursOfDay = Array(0...23).map { String(format: "%02d:00", $0) }

    // أيام شهر ذو الحجة (1-30)
    let hijriDaysInMonth = Array(1...30)
}
```

#### RestorationPhase (محدث)

```swift
struct RestorationPhase: Identifiable {
    let id = UUID()
    var phaseNumber: String
    var outageDurationValue: Double = 0.0      // رقمي
    var restorationSource: String
    var affectedCountValue: Int = 0            // رقمي صحيح
    var restorationMethod: String
}
```

#### Recommendation (محدث)

```swift
struct Recommendation: Identifiable {
    let id = UUID()
    var recommendationText: String
    var responsibleParty: String
    var recommendationSource: String           // حقل جديد
    var targetHijriYear: Int = 1446           // سنة هجرية
    var targetHijriMonth: Int = 1             // شهر هجري
    var targetHijriDay: Int = 1               // يوم هجري

    static let hijriMonths = [
        "محرم", "صفر", "ربيع الأول", "ربيع الثاني",
        "جمادى الأولى", "جمادى الثانية", "رجب", "شعبان",
        "رمضان", "شوال", "ذو القعدة", "ذو الحجة"
    ]
}
```

## 🖼️ **إضافة الصور**

- **الحد الأقصى**: 8 صور
- **المصادر**: الكاميرا أو معرض الصور
- **الموضع**: آخر صفحتين من PDF
- **التخطيط**: 4 صور في كل صفحة (شبكة 2×2)
- **الحجم**: 200×200 نقطة
- **نفس منطق الخدمة المساعدة**: استخدام Core Graphics

## 🔧 **متطلبات التشغيل**

- **iOS**: 17.0+
- **الجهاز**: iPad (محسن للآيباد)
- **Xcode**: 15.0+
- **Swift**: 5.9+

## 📱 **تشغيل التطبيق**

1. افتح ملف `SeraApp.xcodeproj` في Xcode
2. اختر iPad simulator أو جهاز iPad
3. اضغط ⌘+R لتشغيل التطبيق

## 📝 **الاستخدام**

### للخدمة الرئيسية (النموذج الكامل):

1. اختر "ملء النموذج الكامل"
2. املأ جميع الأقسام باستخدام الخيارات المحددة والحقول الرقمية
3. أضف الصور حسب الحاجة
4. انقر "إنتاج PDF" لإنشاء الملف النهائي

### للخدمة المساعدة (إضافة صور فقط):

1. اختر "إضافة صور لـ PDF"
2. اختر ملف PDF من جهازك
3. أضف حتى 8 صور
4. انقر "إضافة الصور وحفظ" لإنشاء ملف جديد

## ⚡ **التحسينات الجديدة**

- **خيارات محددة** بدلاً من النص الحر للتاريخ والوقت
- **إدخال رقمي** للحقول العددية مع validation
- **تاريخ هجري محدود** حسب السنة والشهر المطلوب
- **واجهة أكثر بساطة** وسهولة في الاستخدام
- **تقليل الأخطاء** من خلال التحديد بدلاً من الكتابة

## 🛠️ **التقنيات المستخدمة**

- **SwiftUI**: بناء واجهة المستخدم
- **PDFKit**: معالجة ملفات PDF
- **Core Graphics**: رسم الصور في PDF
- **UIKit**: المكونات المساعدة
- **Foundation**: العمليات الأساسية

## 🎨 **التصميم**

- **دعم RTL**: للغة العربية
- **تصميم متجاوب**: محسن للآيباد
- **ألوان متناسقة**: نظام ألوان احترافي
- **رموز واضحة**: SF Symbols

## 📄 **الملفات الرئيسية**

- `SeraAppApp.swift`: نقطة دخول التطبيق
- `ContentView.swift`: الشاشة الرئيسية
- `FillableFormView.swift`: واجهة النموذج مع المكونات الجديدة
- `FormFieldsModel.swift`: نموذج البيانات المحدث
- `PDFManager.swift`: إدارة PDF ومطابقة الحقول
- `README.md`: هذا الملف

---

**طور بواسطة**: فريق SeraApp  
**الإصدار**: 2.0  
**التاريخ**: ديسمبر 2024  
**الترخيص**: MIT
